<html>

	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		<meta http-equiv="Content-Language" content="fr" />
		<link rel="shortcut icon" href="../ressources/img/favicon.ico">
		<link rel="stylesheet" href="../ressources/style.css" type="text/css"/>
		<script type="text/javascript" src="../ressources/js/jquery-1.9.0.min.js"></script>
		<!--<script type="text/javascript" src="../ressources/flot/jquery.js"></script>-->
		
		<script type="text/javascript" src="../ressources/js/2012/js/jquery-1.7.1.min.js"></script>
		<script type="text/javascript" src="../ressources/js/2012/js/common.js"></script>
		
		<script type="text/javascript" src="../ressources/flot/jquery.flot.js"></script>
		
		<script type="text/javascript" src="../ressources/js/settings.js"></script>

		<title>UBPE 2013 | Graphiques</title>
	</head>

		<body>
		<div id="big-frame">		
			<div id="header">
			</div> <!-- end header -->
			
			<div id="menu">
				<ul>
					<li>
						<a href="../index.html" title="Accueil">Accueil</a>
					</li>
					<li>
						<a href="./donnees.html" title="Données">Données</a>
					</li>
					<li>
						<a href="" title="Graphiques">Graphiques</a>
					</li>
					<li>
						<a href="./carte.html" title="Carte">Carte</a>
					</li>
					<li>
						<a href="./donneesBrutes.html" title="Données brutes">Données brutes</a>
					</li>
				</ul>
			</div> <!-- end menu -->
			
			<div id="frame">
				<div id="page">
					<div id="title">
						<div id="title-left">
							<h2>Graphique du vol</h2>
						</div>
					</div>
					<div id="page-content">
						<div id="graph"></div>
						<div id="button-holder-graphique">
							<ul>
								<li>
									<select name="ordonnee" id="ordonnee" title="Ordonnée">
										<option selected="selected" value="null"> - - - </option>
										<option value="timeGPSFormat">Temps</option>
										<option value="altGPS">Altitude</option>
										<option value="pressure">Pression</option>
										<option value="luxAverage">Luminosité moyenne</option>
										<option value="tempIn">Température intérieur</option>
										<option value="tempOut">Température extérieur</option>
										<option value="speedGPS">Vitesse</option>
									</select>
								</li>
								<li>
									<select name="abscisse" id="abscisse" title="Abscisse">
										<option selected="selected" value="null"> - - - </option>
										<option value="timeGPSFormat">Temps</option>
										<option value="altGPS">Altitude</option>
										<option value="pressure">Pression</option>
										<option value="luxAverage">Luminosité moyenne</option>
										<option value="tempIn">Température intérieur</option>
										<option value="tempOut">Température extérieur</option>
										<option value="speedGPS">Vitesse</option>
									</select>
								</li>
								<li>
								<button id="btnGenerateChart">Générer graphique</button>
								</li>
							</ul>
						</div>
						<script>
							
							json = updateData();

							$(function () {
							
								var graph = $("#graph");
								
								var option =	{
												legend : { show: true, position : 'ne', backgroundColor : null, backgroundOpacity: 0 },
												grid : { show: true, color: '#ff8c00', backgroundColor : null, hoverable: true, mouseActiveRadius: 30},
												xaxis : { color: 'orange' },
												yaxis : { color: 'orange' },
												};
												
								var previousPoint = null;
								
								if ($("#abscisse").val() == "null" && $("#ordonnee").val() == "null" ){
									var vide =[];
									$.plot(graph, vide, option); /*  Créer un graphique vide pour commencer sur la page*/
									graph.append('<div style="position:absolute; left : 27%; top : 43%; color:orange; font-size:24pt">Séléctionner un graphique</div>');
								}
								
								else {
									createChart();
								}
								
								$("#btnGenerateChart").click(function () {
									createChart();
								});
								
								timeTab = new Array();
								timeTab = getTimeBonds(json);
								
								function createChart(){
									abscisse = $("#abscisse").val();
									ordonnee = $("#ordonnee").val();
									nameAbscisse = $("#abscisse option:selected").text();
									nameOrdonnee = $("#ordonnee option:selected").text();
									
									/*alert("Abscisse : " + nameAbscisse + " (" + abscisse + ")" + "\nOrdonnée : " + nameOrdonnee + " (" + ordonnee + ")");*/
									
									var tab = new Array();
									for ( i = 0; i < 166; i++){
										if (abscisse == "timeGPSFormat"){
											tab.push([(json['filtered'][i][abscisse].split(" ")[4]),(json['filtered'][i][ordonnee])]);
										}
										else if (ordonnee == "timeGPSFormat"){
											tab.push([(json['filtered'][i][abscisse]),(json['filtered'][i][ordonnee].split(" ")[4])]);
										}
										else if (abscisse == "timeGPSFormat" && ordonnee == "timeGPSFormat"){
											tab.push([(json['filtered'][i][abscisse].split(" ")[4]),(json['filtered'][i][ordonnee].split(" ")[4])]);
										}
										else {
											tab.push([(json['filtered'][i][abscisse]),(json['filtered'][i][ordonnee])]);
										}
									}
									
									var dTab =	{
											label : nameOrdonnee + " (" + settings.tabUnites[ordonnee] + ") / " + nameAbscisse + " (" + settings.tabUnites[abscisse] + ")", 
											data : tab,
											color : 'red',
											points: { show: true },
											}
									
									$.plot(graph, [dTab], option);
								};
								
								$("#graph").bind("plothover", function (event, pos, item) {
											
									function showTooltip(x, y, contents) {
										$("<div id='tooltip'>" + contents + "</div>").css({
											position: "absolute",
											display: "none",
											top: y + 5,
											left: x + 5,
											border: "1px solid #fdd",
											padding: "2px",
											"background-color": "#fee",
											opacity: 0.80,
											color : "#000000",
										}).appendTo("body").fadeIn(200);
									}
												
									if (item) {
										if (previousPoint != item.dataIndex) {
											previousPoint = item.dataIndex;
											$("#tooltip").remove();
											var x = item.datapoint[0].toFixed(2),
											y = item.datapoint[1].toFixed(2);
											
											showTooltip(item.pageX, item.pageY, nameOrdonnee + " = " + y + " " + settings.tabUnites[ordonnee] + "<br/>" + nameAbscisse + " = " + x + " " + settings.tabUnites[abscisse]);
											}
										} 
										else {
												$("#tooltip").remove();
												previousPoint = null;            
											}
								});
							});
						</script>
						<p>
							Ce graphique permet de consulter graphiquement les données envoyées par le ballon.
						</p>
					</div>
				</div> <!-- end page -->
			</div> <!-- end frame -->
			
			<div id="footer">
				<div id="footer-left">
					UBPE 2013 - <a href="./credits.html" title="Page des crédits">Projet UBPE, IUT Valence</a>
				</div>
				<div id="footer-right">
				
					<ul>
						<li>
							<a href="http://iut-valence.fr"><img src="../ressources/img/logoiut2.png" title="IUT Valence" alt="Logo IUT Valence"></a>
						</li>
					</ul>
					
				</div>
			</div> <!-- end footer -->	
		</div>
		</body>
	
</html>